{"ast":null,"code":"import React,{useState,useEffect}from'react';import{MapContainer,TileLayer,Marker,Popup,GeoJSON}from'react-leaflet';import MarkerClusterGroup from'react-leaflet-cluster';import'leaflet/dist/leaflet.css';import{Icon}from'leaflet';import{API}from'../services/API';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Map=_ref=>{let{center,zoom,onRegionClick,onCityClick}=_ref;const customerIcon=new Icon({iconUrl:'/img/gps.png',iconSize:[28,28]});const[regions,setRegions]=useState([]);const[geojsonData,setGeojsonData]=useState(null);const[selectedRegion,setSelectedRegion]=useState(null);const[villes,setVilles]=useState([]);useEffect(()=>{const getdataregion=async()=>{try{const response=await API.get(\"/api/personnes-agees-par-regions\",{withCredentials:true});const responseData=await response.data;setRegions(responseData);}catch(error){console.error('Error fetching data:',error);}};getdataregion();},[]);useEffect(()=>{fetch(\"/departements.geojson\").then(response=>response.json()).then(data=>setGeojsonData(data)).catch(error=>console.error('Erreur lors de la récupération du fichier GeoJSON:',error));},[]);const handleRegionClick=async regionName=>{try{setSelectedRegion(regionName);const response=await API.get(\"/api/villes-par-regions/\".concat(regionName),{withCredentials:true});const responseData=await response.data;setVilles(responseData);onRegionClick(regionName);}catch(error){console.error('Error fetching data:',error);}};const handleCityClick=async cityName=>{try{const response=await API.get(\"/api/age-distribution-ville-radius/\".concat(cityName),{withCredentials:true});const responseData=await response.data;onCityClick(responseData);// Pass data to parent component\n}catch(error){console.error('Error fetching city data:',error);}};return/*#__PURE__*/_jsx(\"div\",{style:{height:'100vh',width:'100%'},children:/*#__PURE__*/_jsxs(MapContainer,{center:center,zoom:zoom,style:{height:'100%',width:'100%'},children:[/*#__PURE__*/_jsx(TileLayer,{url:\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"}),geojsonData&&/*#__PURE__*/_jsx(GeoJSON,{data:geojsonData,style:()=>({color:'white',weight:2,opacity:1,dashArray:'3',fillOpacity:0.7,fillColor:'#1396D9'}),onEachFeature:(feature,layer)=>{layer.on({mouseover:e=>{const layer=e.target;layer.setStyle({dashArray:\"\",fillColor:\"#BD0026\",fillOpacity:0.7,weight:2,opacity:1,color:\"white\"});},mouseout:e=>{const layer=e.target;layer.setStyle({fillOpacity:0.7,opacity:1,weight:2,dashArray:\"3\",color:'white',fillColor:'#1396D9'});},click:()=>{handleRegionClick(feature.properties.name);}});}}),/*#__PURE__*/_jsx(MarkerClusterGroup,{children:selectedRegion&&villes.length>0?villes.map(ville=>/*#__PURE__*/_jsx(Marker,{icon:customerIcon,position:[ville.latitude,ville.longitude],children:/*#__PURE__*/_jsxs(Popup,{children:[ville.nom,\" \",/*#__PURE__*/_jsx(\"br\",{}),\"F65-79ans : \",ville.femmes_65_79,\" \",/*#__PURE__*/_jsx(\"br\",{}),\"F+80ans : \",ville.femmes_80_plus,\" \",/*#__PURE__*/_jsx(\"br\",{}),\"H65-79ans : \",ville.hommes_65_79,\" \",/*#__PURE__*/_jsx(\"br\",{}),\"H+80ans: \",ville.hommes_80_plus,\" \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleCityClick(ville.nom),children:\"Calculer les prospects dans un rayon de 50km\"})]})},ville.nom)):Object.keys(regions).map(region=>/*#__PURE__*/_jsx(Marker,{icon:customerIcon,position:[regions[region].latitude,regions[region].longitude],eventHandlers:{click:()=>{handleRegionClick(region);}},children:/*#__PURE__*/_jsxs(Popup,{children:[\"R\\xE9gion : \",region,\" \",/*#__PURE__*/_jsx(\"br\",{}),\"F65-79ans : \",regions[region].femmes_65_79,\" \",/*#__PURE__*/_jsx(\"br\",{}),\"F+80ans : \",regions[region].femmes_80_plus,\" \",/*#__PURE__*/_jsx(\"br\",{}),\"H65-79ans : \",regions[region].hommes_65_79,\" \",/*#__PURE__*/_jsx(\"br\",{}),\"H+80ans: \",regions[region].hommes_80_plus,\" \",/*#__PURE__*/_jsx(\"br\",{})]})},region))})]})});};export default Map;","map":{"version":3,"names":["React","useState","useEffect","MapContainer","TileLayer","Marker","Popup","GeoJSON","MarkerClusterGroup","Icon","API","jsx","_jsx","jsxs","_jsxs","Map","_ref","center","zoom","onRegionClick","onCityClick","customerIcon","iconUrl","iconSize","regions","setRegions","geojsonData","setGeojsonData","selectedRegion","setSelectedRegion","villes","setVilles","getdataregion","response","get","withCredentials","responseData","data","error","console","fetch","then","json","catch","handleRegionClick","regionName","concat","handleCityClick","cityName","style","height","width","children","url","color","weight","opacity","dashArray","fillOpacity","fillColor","onEachFeature","feature","layer","on","mouseover","e","target","setStyle","mouseout","click","properties","name","length","map","ville","icon","position","latitude","longitude","nom","femmes_65_79","femmes_80_plus","hommes_65_79","hommes_80_plus","onClick","Object","keys","region","eventHandlers"],"sources":["/Users/jujupeneau/Desktop/Wildcodeschool_Data_engineer/projet/Lama_dev_login/react_simple_copy/src/components/Map.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { MapContainer, TileLayer, Marker, Popup, GeoJSON } from 'react-leaflet';\nimport MarkerClusterGroup from 'react-leaflet-cluster';\nimport 'leaflet/dist/leaflet.css';\nimport { Icon } from 'leaflet';\nimport { API } from '../services/API';\n\nconst Map = ({ center, zoom, onRegionClick, onCityClick }) => {\n    const customerIcon = new Icon({\n        iconUrl: '/img/gps.png',\n        iconSize: [28, 28],\n    });\n    const [regions, setRegions] = useState([]);\n    const [geojsonData, setGeojsonData] = useState(null);\n    const [selectedRegion, setSelectedRegion] = useState(null);\n    const [villes, setVilles] = useState([]);\n\n    useEffect(() => {\n        const getdataregion = async () => {\n            try {\n                const response = await API.get(\"/api/personnes-agees-par-regions\", {\n                    withCredentials: true,\n                });\n                const responseData = await response.data;\n                setRegions(responseData);\n            } catch (error) {\n                console.error('Error fetching data:', error);\n            }\n        };\n\n        getdataregion();\n    }, []);\n\n    useEffect(() => {\n        fetch(\"/departements.geojson\")\n            .then(response => response.json())\n            .then(data => setGeojsonData(data))\n            .catch(error => console.error('Erreur lors de la récupération du fichier GeoJSON:', error));\n    }, []);\n\n    const handleRegionClick = async (regionName) => {\n        try {\n            setSelectedRegion(regionName);\n            const response = await API.get(`/api/villes-par-regions/${regionName}`, {\n                withCredentials: true,\n            });\n            const responseData = await response.data;\n            setVilles(responseData);\n            onRegionClick(regionName);\n        } catch (error) {\n            console.error('Error fetching data:', error);\n        }\n    };\n\n    const handleCityClick = async (cityName) => {\n        try {\n            const response = await API.get(`/api/age-distribution-ville-radius/${cityName}`, {\n                withCredentials: true,\n            });\n            const responseData = await response.data;\n            onCityClick(responseData); // Pass data to parent component\n        } catch (error) {\n            console.error('Error fetching city data:', error);\n        }\n    };\n\n    return (\n        <div style={{ height: '100vh', width: '100%' }}>\n            <MapContainer center={center} zoom={zoom} style={{ height: '100%', width: '100%' }}>\n                <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" />\n\n                {geojsonData && (\n                    <GeoJSON\n                        data={geojsonData}\n                        style={() => ({\n                            color: 'white',\n                            weight: 2,\n                            opacity: 1,\n                            dashArray: '3',\n                            fillOpacity: 0.7,\n                            fillColor: '#1396D9'\n                        })}\n                        onEachFeature={(feature, layer) => {\n                            layer.on({\n                                mouseover: (e) => {\n                                    const layer = e.target;\n                                    layer.setStyle({\n                                        dashArray: \"\",\n                                        fillColor: \"#BD0026\",\n                                        fillOpacity: 0.7,\n                                        weight: 2,\n                                        opacity: 1,\n                                        color: \"white\",\n                                    });\n                                },\n                                mouseout: (e) => {\n                                    const layer = e.target;\n                                    layer.setStyle({\n                                        fillOpacity: 0.7,\n                                        opacity: 1,\n                                        weight: 2,\n                                        dashArray: \"3\",\n                                        color: 'white',\n                                        fillColor: '#1396D9'\n                                    });\n                                },\n                                click: () => {\n                                    handleRegionClick(feature.properties.name);\n                                }\n                            });\n                        }}\n                    />\n                )}\n\n                <MarkerClusterGroup>\n                    {selectedRegion && villes.length > 0 ? (\n                        villes.map(ville => (\n                            <Marker icon={customerIcon} key={ville.nom} position={[ville.latitude, ville.longitude]}>\n                                <Popup>\n                                    {ville.nom} <br />\n                                    F65-79ans : {ville.femmes_65_79} <br />\n                                    F+80ans : {ville.femmes_80_plus} <br />\n                                    H65-79ans : {ville.hommes_65_79} <br />\n                                    H+80ans: {ville.hommes_80_plus} <br />\n                                    <button onClick={() => handleCityClick(ville.nom)}>Calculer les prospects dans un rayon de 50km</button>\n                                </Popup>\n                            </Marker>\n                        ))\n                    ) : (\n                        Object.keys(regions).map(region => (\n                            <Marker \n                                icon={customerIcon}\n                                key={region}\n                                position={[regions[region].latitude, regions[region].longitude]}\n                                eventHandlers={{\n                                    click: () => {\n                                        handleRegionClick(region);\n                                    },\n                                }}\n                            >\n                                <Popup>\n                                    Région : {region} <br />\n                                    F65-79ans : {regions[region].femmes_65_79} <br />\n                                    F+80ans : {regions[region].femmes_80_plus} <br />\n                                    H65-79ans : {regions[region].hommes_65_79} <br />\n                                    H+80ans: {regions[region].hommes_80_plus} <br />\n                                </Popup>\n                            </Marker>\n                        ))\n                    )}\n                </MarkerClusterGroup>\n            </MapContainer>\n        </div>\n    );\n};\n\nexport default Map;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,OAASC,YAAY,CAAEC,SAAS,CAAEC,MAAM,CAAEC,KAAK,CAAEC,OAAO,KAAQ,eAAe,CAC/E,MAAO,CAAAC,kBAAkB,KAAM,uBAAuB,CACtD,MAAO,0BAA0B,CACjC,OAASC,IAAI,KAAQ,SAAS,CAC9B,OAASC,GAAG,KAAQ,iBAAiB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEtC,KAAM,CAAAC,GAAG,CAAGC,IAAA,EAAkD,IAAjD,CAAEC,MAAM,CAAEC,IAAI,CAAEC,aAAa,CAAEC,WAAY,CAAC,CAAAJ,IAAA,CACrD,KAAM,CAAAK,YAAY,CAAG,GAAI,CAAAZ,IAAI,CAAC,CAC1Ba,OAAO,CAAE,cAAc,CACvBC,QAAQ,CAAE,CAAC,EAAE,CAAE,EAAE,CACrB,CAAC,CAAC,CACF,KAAM,CAACC,OAAO,CAAEC,UAAU,CAAC,CAAGxB,QAAQ,CAAC,EAAE,CAAC,CAC1C,KAAM,CAACyB,WAAW,CAAEC,cAAc,CAAC,CAAG1B,QAAQ,CAAC,IAAI,CAAC,CACpD,KAAM,CAAC2B,cAAc,CAAEC,iBAAiB,CAAC,CAAG5B,QAAQ,CAAC,IAAI,CAAC,CAC1D,KAAM,CAAC6B,MAAM,CAAEC,SAAS,CAAC,CAAG9B,QAAQ,CAAC,EAAE,CAAC,CAExCC,SAAS,CAAC,IAAM,CACZ,KAAM,CAAA8B,aAAa,CAAG,KAAAA,CAAA,GAAY,CAC9B,GAAI,CACA,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAvB,GAAG,CAACwB,GAAG,CAAC,kCAAkC,CAAE,CAC/DC,eAAe,CAAE,IACrB,CAAC,CAAC,CACF,KAAM,CAAAC,YAAY,CAAG,KAAM,CAAAH,QAAQ,CAACI,IAAI,CACxCZ,UAAU,CAACW,YAAY,CAAC,CAC5B,CAAE,MAAOE,KAAK,CAAE,CACZC,OAAO,CAACD,KAAK,CAAC,sBAAsB,CAAEA,KAAK,CAAC,CAChD,CACJ,CAAC,CAEDN,aAAa,CAAC,CAAC,CACnB,CAAC,CAAE,EAAE,CAAC,CAEN9B,SAAS,CAAC,IAAM,CACZsC,KAAK,CAAC,uBAAuB,CAAC,CACzBC,IAAI,CAACR,QAAQ,EAAIA,QAAQ,CAACS,IAAI,CAAC,CAAC,CAAC,CACjCD,IAAI,CAACJ,IAAI,EAAIV,cAAc,CAACU,IAAI,CAAC,CAAC,CAClCM,KAAK,CAACL,KAAK,EAAIC,OAAO,CAACD,KAAK,CAAC,oDAAoD,CAAEA,KAAK,CAAC,CAAC,CACnG,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAM,iBAAiB,CAAG,KAAO,CAAAC,UAAU,EAAK,CAC5C,GAAI,CACAhB,iBAAiB,CAACgB,UAAU,CAAC,CAC7B,KAAM,CAAAZ,QAAQ,CAAG,KAAM,CAAAvB,GAAG,CAACwB,GAAG,4BAAAY,MAAA,CAA4BD,UAAU,EAAI,CACpEV,eAAe,CAAE,IACrB,CAAC,CAAC,CACF,KAAM,CAAAC,YAAY,CAAG,KAAM,CAAAH,QAAQ,CAACI,IAAI,CACxCN,SAAS,CAACK,YAAY,CAAC,CACvBjB,aAAa,CAAC0B,UAAU,CAAC,CAC7B,CAAE,MAAOP,KAAK,CAAE,CACZC,OAAO,CAACD,KAAK,CAAC,sBAAsB,CAAEA,KAAK,CAAC,CAChD,CACJ,CAAC,CAED,KAAM,CAAAS,eAAe,CAAG,KAAO,CAAAC,QAAQ,EAAK,CACxC,GAAI,CACA,KAAM,CAAAf,QAAQ,CAAG,KAAM,CAAAvB,GAAG,CAACwB,GAAG,uCAAAY,MAAA,CAAuCE,QAAQ,EAAI,CAC7Eb,eAAe,CAAE,IACrB,CAAC,CAAC,CACF,KAAM,CAAAC,YAAY,CAAG,KAAM,CAAAH,QAAQ,CAACI,IAAI,CACxCjB,WAAW,CAACgB,YAAY,CAAC,CAAE;AAC/B,CAAE,MAAOE,KAAK,CAAE,CACZC,OAAO,CAACD,KAAK,CAAC,2BAA2B,CAAEA,KAAK,CAAC,CACrD,CACJ,CAAC,CAED,mBACI1B,IAAA,QAAKqC,KAAK,CAAE,CAAEC,MAAM,CAAE,OAAO,CAAEC,KAAK,CAAE,MAAO,CAAE,CAAAC,QAAA,cAC3CtC,KAAA,CAACX,YAAY,EAACc,MAAM,CAAEA,MAAO,CAACC,IAAI,CAAEA,IAAK,CAAC+B,KAAK,CAAE,CAAEC,MAAM,CAAE,MAAM,CAAEC,KAAK,CAAE,MAAO,CAAE,CAAAC,QAAA,eAC/ExC,IAAA,CAACR,SAAS,EAACiD,GAAG,CAAC,oDAAoD,CAAE,CAAC,CAErE3B,WAAW,eACRd,IAAA,CAACL,OAAO,EACJ8B,IAAI,CAAEX,WAAY,CAClBuB,KAAK,CAAEA,CAAA,IAAO,CACVK,KAAK,CAAE,OAAO,CACdC,MAAM,CAAE,CAAC,CACTC,OAAO,CAAE,CAAC,CACVC,SAAS,CAAE,GAAG,CACdC,WAAW,CAAE,GAAG,CAChBC,SAAS,CAAE,SACf,CAAC,CAAE,CACHC,aAAa,CAAEA,CAACC,OAAO,CAAEC,KAAK,GAAK,CAC/BA,KAAK,CAACC,EAAE,CAAC,CACLC,SAAS,CAAGC,CAAC,EAAK,CACd,KAAM,CAAAH,KAAK,CAAGG,CAAC,CAACC,MAAM,CACtBJ,KAAK,CAACK,QAAQ,CAAC,CACXV,SAAS,CAAE,EAAE,CACbE,SAAS,CAAE,SAAS,CACpBD,WAAW,CAAE,GAAG,CAChBH,MAAM,CAAE,CAAC,CACTC,OAAO,CAAE,CAAC,CACVF,KAAK,CAAE,OACX,CAAC,CAAC,CACN,CAAC,CACDc,QAAQ,CAAGH,CAAC,EAAK,CACb,KAAM,CAAAH,KAAK,CAAGG,CAAC,CAACC,MAAM,CACtBJ,KAAK,CAACK,QAAQ,CAAC,CACXT,WAAW,CAAE,GAAG,CAChBF,OAAO,CAAE,CAAC,CACVD,MAAM,CAAE,CAAC,CACTE,SAAS,CAAE,GAAG,CACdH,KAAK,CAAE,OAAO,CACdK,SAAS,CAAE,SACf,CAAC,CAAC,CACN,CAAC,CACDU,KAAK,CAAEA,CAAA,GAAM,CACTzB,iBAAiB,CAACiB,OAAO,CAACS,UAAU,CAACC,IAAI,CAAC,CAC9C,CACJ,CAAC,CAAC,CACN,CAAE,CACL,CACJ,cAED3D,IAAA,CAACJ,kBAAkB,EAAA4C,QAAA,CACdxB,cAAc,EAAIE,MAAM,CAAC0C,MAAM,CAAG,CAAC,CAChC1C,MAAM,CAAC2C,GAAG,CAACC,KAAK,eACZ9D,IAAA,CAACP,MAAM,EAACsE,IAAI,CAAEtD,YAAa,CAAiBuD,QAAQ,CAAE,CAACF,KAAK,CAACG,QAAQ,CAAEH,KAAK,CAACI,SAAS,CAAE,CAAA1B,QAAA,cACpFtC,KAAA,CAACR,KAAK,EAAA8C,QAAA,EACDsB,KAAK,CAACK,GAAG,CAAC,GAAC,cAAAnE,IAAA,QAAK,CAAC,eACN,CAAC8D,KAAK,CAACM,YAAY,CAAC,GAAC,cAAApE,IAAA,QAAK,CAAC,aAC7B,CAAC8D,KAAK,CAACO,cAAc,CAAC,GAAC,cAAArE,IAAA,QAAK,CAAC,eAC3B,CAAC8D,KAAK,CAACQ,YAAY,CAAC,GAAC,cAAAtE,IAAA,QAAK,CAAC,YAC9B,CAAC8D,KAAK,CAACS,cAAc,CAAC,GAAC,cAAAvE,IAAA,QAAK,CAAC,cACtCA,IAAA,WAAQwE,OAAO,CAAEA,CAAA,GAAMrC,eAAe,CAAC2B,KAAK,CAACK,GAAG,CAAE,CAAA3B,QAAA,CAAC,8CAA4C,CAAQ,CAAC,EACrG,CAAC,EARqBsB,KAAK,CAACK,GAS/B,CACX,CAAC,CAEFM,MAAM,CAACC,IAAI,CAAC9D,OAAO,CAAC,CAACiD,GAAG,CAACc,MAAM,eAC3B3E,IAAA,CAACP,MAAM,EACHsE,IAAI,CAAEtD,YAAa,CAEnBuD,QAAQ,CAAE,CAACpD,OAAO,CAAC+D,MAAM,CAAC,CAACV,QAAQ,CAAErD,OAAO,CAAC+D,MAAM,CAAC,CAACT,SAAS,CAAE,CAChEU,aAAa,CAAE,CACXnB,KAAK,CAAEA,CAAA,GAAM,CACTzB,iBAAiB,CAAC2C,MAAM,CAAC,CAC7B,CACJ,CAAE,CAAAnC,QAAA,cAEFtC,KAAA,CAACR,KAAK,EAAA8C,QAAA,EAAC,cACM,CAACmC,MAAM,CAAC,GAAC,cAAA3E,IAAA,QAAK,CAAC,eACZ,CAACY,OAAO,CAAC+D,MAAM,CAAC,CAACP,YAAY,CAAC,GAAC,cAAApE,IAAA,QAAK,CAAC,aACvC,CAACY,OAAO,CAAC+D,MAAM,CAAC,CAACN,cAAc,CAAC,GAAC,cAAArE,IAAA,QAAK,CAAC,eACrC,CAACY,OAAO,CAAC+D,MAAM,CAAC,CAACL,YAAY,CAAC,GAAC,cAAAtE,IAAA,QAAK,CAAC,YACxC,CAACY,OAAO,CAAC+D,MAAM,CAAC,CAACJ,cAAc,CAAC,GAAC,cAAAvE,IAAA,QAAK,CAAC,EAC7C,CAAC,EAdH2E,MAeD,CACX,CACJ,CACe,CAAC,EACX,CAAC,CACd,CAAC,CAEd,CAAC,CAED,cAAe,CAAAxE,GAAG","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}